apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: scenarios.powerfulseal.io
spec:
  group: powerfulseal.io
  scope: Namespaced
  names:
    plural: scenarios
    singular: scenario
    kind: Scenario
    shortNames:
      - scenario
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          required:
            - spec
          properties:
            spec:
              type: object
              description: >
                A scenario contains all the steps necessary to prepare,
                implement and validate a chaos engineering experiment.
              properties:
                name:
                  type: string
                  description: >
                    A brief, descriptive name of the scenario. Will be used to
                    identify the scenario in logs.
                  minLength: 3
                  maxLength: 80
                description:
                  type: string
                  description: >
                    A longer description, helping to understand what the
                    scenario is doing when reading the yaml file. Optional.
                steps:
                  type: array
                  description: >
                    The sequence of events to prepare, validate, execute and
                    analyse the chaos engineering experiment.
                  items:
                    oneOf:
                      - properties:
                          probeHTTP:
                            properties:
                              target:
                                oneOf:
                                  - properties:
                                      url: {}
                                    required:
                                      - url
                                  - properties:
                                      service:
                                        properties:
                                          name: {}
                                          namespace: {}
                                          port:
                                            minimum: 1
                                            maximum: 65535
                                          protocol:
                                            enum:
                                              - http
                                              - https
                                        required:
                                          - name
                                          - namespace
                                    required:
                                      - service
                              retries:
                                minimum: 1
                              delay:
                                minimum: 1
                              timeout:
                                minimum: 1
                              code:
                                minimum: 1
                                maximum: 599
                              count:
                                minimum: 1
                              endpoint: {}
                              method:
                                enum:
                                  - get
                                  - post
                                  - patch
                                  - head
                                  - delete
                              body: {}
                              headers:
                                items:
                                  properties:
                                    name: {}
                                    value: {}
                              proxy: {}
                              insecure: {}
                            required:
                              - target
                        required:
                          - probeHTTP
                      - properties:
                          kubectl:
                            properties:
                              action:
                                enum:
                                  - apply
                                  - delete
                              payload: {}
                              autoDelete: {}
                              proxy: {}
                              kubectlBinary: {}
                            required:
                              - action
                              - payload
                        required:
                          - kubectl
                      - properties:
                          podAction:
                            properties:
                              matches:
                                items:
                                  oneOf:
                                    - properties:
                                        namespace: {}
                                      required:
                                        - namespace
                                    - properties:
                                        deployment:
                                          properties:
                                            name: {}
                                            namespace: {}
                                          required:
                                            - name
                                            - namespace
                                      required:
                                        - deployment
                                    - properties:
                                        labels:
                                          properties:
                                            selector: {}
                                            namespace: {}
                                          required:
                                            - selector
                                            - namespace
                                      required:
                                        - labels
                              filters:
                                items:
                                  oneOf:
                                    - properties:
                                        property:
                                          properties:
                                            name:
                                              enum:
                                                - name
                                                - state
                                            value: {}
                                            negative: {}
                                          required:
                                            - name
                                            - value
                                      required:
                                        - property
                                    - properties:
                                        dayTime:
                                          properties:
                                            onlyDays:
                                              items:
                                                enum:
                                                  - monday
                                                  - tuesday
                                                  - wednesday
                                                  - thursday
                                                  - friday
                                                  - saturday
                                                  - sunday
                                            startTime:
                                              properties:
                                                hour:
                                                  minimum: 0
                                                  maximum: 23
                                                minute:
                                                  minimum: 0
                                                  maximum: 59
                                                second:
                                                  minimum: 0
                                                  maximum: 59
                                              required:
                                                - hour
                                                - minute
                                                - second
                                            endTime:
                                              properties:
                                                hour:
                                                  minimum: 0
                                                  maximum: 23
                                                minute:
                                                  minimum: 0
                                                  maximum: 59
                                                second:
                                                  minimum: 0
                                                  maximum: 59
                                              required:
                                                - hour
                                                - minute
                                                - second
                                          required:
                                            - onlyDays
                                            - startTime
                                            - endTime
                                      required:
                                        - dayTime
                                    - properties:
                                        randomSample:
                                          properties:
                                            size:
                                              minimum: 1
                                            ratio:
                                              minimum: 0
                                              maximum: 1
                                      required:
                                        - randomSample
                                    - properties:
                                        probability:
                                          minimum: 0
                                          maximum: 1
                                      required:
                                        - probability
                              retries:
                                oneOf:
                                  - properties:
                                      retriesCount:
                                        properties:
                                          count:
                                            minimum: 0
                                          sleep:
                                            minimum: 0
                                        required:
                                          - count
                                    required:
                                      - retriesCount
                                  - properties:
                                      retriesTimeout:
                                        properties:
                                          timeout:
                                            minimum: 0
                                          sleep:
                                            minimum: 0
                                        required:
                                          - timeout
                                    required:
                                      - retriesTimeout
                              actions:
                                items:
                                  oneOf:
                                    - properties:
                                        kill:
                                          properties:
                                            probability:
                                              minimum: 0
                                              maximum: 1
                                            force: {}
                                      required:
                                        - kill
                                    - properties:
                                        wait:
                                          properties:
                                            seconds:
                                              minimum: 0
                                          required:
                                            - seconds
                                      required:
                                        - wait
                                    - properties:
                                        checkPodState:
                                          properties:
                                            state: {}
                                          required:
                                            - state
                                      required:
                                        - checkPodState
                                    - properties:
                                        checkPodCount:
                                          properties:
                                            count: {}
                                          required:
                                            - count
                                      required:
                                        - checkPodCount
                                    - properties:
                                        stopHost:
                                          properties:
                                            autoRestart: {}
                                      required:
                                        - stopHost
                            required:
                              - matches
                              - actions
                        required:
                          - podAction
                      - properties:
                          nodeAction:
                            properties:
                              matches:
                                items:
                                  oneOf:
                                    - properties:
                                        property:
                                          properties:
                                            name:
                                              enum:
                                                - name
                                                - ip
                                                - group
                                                - az
                                                - state
                                            value: {}
                                            negative: {}
                                          required:
                                            - name
                                            - value
                                      required:
                                        - property
                              retries:
                                oneOf:
                                  - properties:
                                      retriesCount:
                                        properties:
                                          count:
                                            minimum: 0
                                          sleep:
                                            minimum: 0
                                        required:
                                          - count
                                    required:
                                      - retriesCount
                                  - properties:
                                      retriesTimeout:
                                        properties:
                                          timeout:
                                            minimum: 0
                                          sleep:
                                            minimum: 0
                                        required:
                                          - timeout
                                    required:
                                      - retriesTimeout
                              filters:
                                items:
                                  oneOf:
                                    - properties:
                                        property:
                                          properties:
                                            name:
                                              enum:
                                                - name
                                                - ip
                                                - group
                                                - az
                                                - state
                                            value: {}
                                            negative: {}
                                          required:
                                            - name
                                            - value
                                      required:
                                        - property
                                    - properties:
                                        dayTime:
                                          properties:
                                            onlyDays:
                                              items:
                                                enum:
                                                  - monday
                                                  - tuesday
                                                  - wednesday
                                                  - thursday
                                                  - friday
                                                  - saturday
                                                  - sunday
                                            startTime:
                                              properties:
                                                hour:
                                                  minimum: 0
                                                  maximum: 23
                                                minute:
                                                  minimum: 0
                                                  maximum: 59
                                                second:
                                                  minimum: 0
                                                  maximum: 59
                                              required:
                                                - hour
                                                - minute
                                                - second
                                            endTime:
                                              properties:
                                                hour:
                                                  minimum: 0
                                                  maximum: 23
                                                minute:
                                                  minimum: 0
                                                  maximum: 59
                                                second:
                                                  minimum: 0
                                                  maximum: 59
                                              required:
                                                - hour
                                                - minute
                                                - second
                                          required:
                                            - onlyDays
                                            - startTime
                                            - endTime
                                      required:
                                        - dayTime
                                    - properties:
                                        randomSample:
                                          properties:
                                            size:
                                              minimum: 1
                                            ratio:
                                              minimum: 0
                                              maximum: 1
                                      required:
                                        - randomSample
                                    - properties:
                                        probability:
                                          minimum: 0
                                          maximum: 1
                                      required:
                                        - probability
                              actions:
                                items:
                                  oneOf:
                                    - properties:
                                        start: {}
                                      required:
                                        - start
                                    - properties:
                                        stop:
                                          properties:
                                            force: {}
                                            autoRestart: {}
                                      required:
                                        - stop
                                    - properties:
                                        execute:
                                          properties:
                                            cmd: {}
                                          required:
                                            - cmd
                                      required:
                                        - execute
                                    - properties:
                                        wait:
                                          properties:
                                            seconds:
                                              minimum: 0
                                          required:
                                            - seconds
                                      required:
                                        - wait
                            required:
                              - matches
                              - actions
                        required:
                          - nodeAction
                      - properties:
                          wait:
                            properties:
                              seconds:
                                minimum: 0
                            required:
                              - seconds
                        required:
                          - wait
                      - properties:
                          clone:
                            properties:
                              replicas:
                                minimum: 1
                              source:
                                oneOf:
                                  - properties:
                                      deployment:
                                        properties:
                                          name: {}
                                          namespace: {}
                                        required:
                                          - name
                                          - namespace
                                    required:
                                      - deployment
                              labels:
                                items:
                                  oneOf:
                                    - properties:
                                        service:
                                          properties:
                                            name: {}
                                            namespace: {}
                                          required:
                                            - name
                                            - namespace
                                      required:
                                        - service
                                    - properties:
                                        label:
                                          properties:
                                            key: {}
                                            value: {}
                                          required:
                                            - key
                                            - value
                                      required:
                                        - label
                              mutations:
                                items:
                                  oneOf:
                                    - properties:
                                        tc:
                                          properties:
                                            command:
                                              items: {}
                                            args:
                                              items: {}
                                            user:
                                              minimum: 0
                                            image: {}
                                          required:
                                            - command
                                      required:
                                        - tc
                                    - properties:
                                        toxiproxy:
                                          properties:
                                            user:
                                              minimum: 0
                                            imageIptables: {}
                                            imageToxiproxy: {}
                                            toxiproxyCli: {}
                                            proxies:
                                              items:
                                                properties:
                                                  name: {}
                                                  listen: {}
                                                  upstream: {}
                                                required:
                                                  - name
                                                  - listen
                                                  - upstream
                                            toxics:
                                              items:
                                                properties:
                                                  targetProxy: {}
                                                  toxicType: {}
                                                  toxicAttributes:
                                                    items:
                                                      properties:
                                                        name: {}
                                                        value: {}
                                                      required:
                                                        - name
                                                        - value
                                                required:
                                                  - targetProxy
                                                  - toxicType
                                      required:
                                        - toxiproxy
                                    - properties:
                                        environment:
                                          properties:
                                            name: {}
                                            value: {}
                                          required:
                                            - name
                                            - value
                                      required:
                                        - environment
                            required:
                              - source
                        required:
                          - clone
                      - properties:
                          alertManagerAction:
                            targets:
                              items:
                                oneOf:
                                  - properties:
                                      url: {}
                                    required:
                                      - url
                            actions:
                              items:
                                oneOf:
                                  - properties:
                                      mute:
                                        properties:
                                          duration:
                                            minimum: 60
                                            maximum: 86400
                                          autoUnmute: {}
                                    required:
                                      - mute
                            retries:
                              oneOf:
                                - properties:
                                    retriesCount:
                                      properties:
                                        count:
                                          minimum: 0
                                        sleep:
                                          minimum: 0
                                      required:
                                        - count
                                  required:
                                    - retriesCount
                                - properties:
                                    retriesTimeout:
                                      properties:
                                        timeout:
                                          minimum: 0
                                        sleep:
                                          minimum: 0
                                      required:
                                        - timeout
                                  required:
                                    - retriesTimeout
                            proxies:
                              properties:
                                http: {}
                                https: {}
                            required:
                              - targets
                              - actions
                        required:
                          - alertManagerAction
                    type: object
              required:
                - name
                - steps
